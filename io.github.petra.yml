app-id: io.github.petra
runtime: org.kde.Platform
runtime-version: '6.7'
sdk: org.kde.Sdk
command: petra

finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # D-Bus session for clipboard and shortcuts
  - --socket=session-bus
  # For global shortcuts portals
  - --talk-name=org.freedesktop.portal.*
  - --talk-name=org.kde.kglobalaccel
  # Home directory for config
  - --filesystem=xdg-config/petra:create
  # Access to host tools like xdotool, ydotool
  - --talk-name=org.freedesktop.Flatpak
  # Device access for input simulation
  - --device=dri

build-options:
  build-args:
    - --share=network

modules:
  - name: python-deps
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=${FLATPAK_DEST} PyQt6
    
  - name: petra
    buildsystem: simple
    build-commands:
      - install -Dm755 petra.sh ${FLATPAK_DEST}/bin/petra
      - mkdir -p ${FLATPAK_DEST}/share/petra
      - cp -r *.py icons ${FLATPAK_DEST}/share/petra/
      - install -Dm644 io.github.petra.desktop ${FLATPAK_DEST}/share/applications/io.github.petra.desktop
      - install -Dm644 io.github.petra.metainfo.xml ${FLATPAK_DEST}/share/metainfo/io.github.petra.metainfo.xml
      # Instalar ícono SVG escalable
      - install -Dm644 icons/petra.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/io.github.petra.svg
      # Instalar ícono PNG en múltiples tamaños estándar para compatibilidad
      - install -Dm644 icons/petra.png ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/io.github.petra.png
      - install -Dm644 icons/petra-256.png ${FLATPAK_DEST}/share/icons/hicolor/256x256/apps/io.github.petra.png
      - install -Dm644 icons/petra-128.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/io.github.petra.png
      - install -Dm644 icons/petra-64.png ${FLATPAK_DEST}/share/icons/hicolor/64x64/apps/io.github.petra.png
      - install -Dm644 icons/petra-48.png ${FLATPAK_DEST}/share/icons/hicolor/48x48/apps/io.github.petra.png
      - install -Dm644 icons/petra-32.png ${FLATPAK_DEST}/share/icons/hicolor/32x32/apps/io.github.petra.png
      - install -Dm644 icons/petra-16.png ${FLATPAK_DEST}/share/icons/hicolor/16x16/apps/io.github.petra.png
    sources:
      - type: dir
        path: .
